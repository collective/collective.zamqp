[buildout]
extensions = buildout.dumppickedversions
             mr.developer
dump-picked-versions-file = versions-picked.cfg
auto-checkout =
sources-dir = src
versions = versions
extends = http://download.zope.org/Zope2/index/2.12.3/versions.cfg
          http://dist.plone.org/release/4.0a5/versions.cfg
          versions.cfg
develop =
    .
index = http://pypi.affinitic.be

find-links =
        http://packages.affinitic.be/simple
        http://eggs.affinitic.be/

parts =
    PILwoTK
    zeo
    instance01
    instance02
    omelette
    scripts
    test
    coverage-test
    coverage-report
    docs
    command

#    rabbitmq
eggs =
    affinitic.zamqp [zope212]

zcml =
    affinitic.zamqp

[zeo]
recipe = plone.recipe.zeoserver
zeo-address = 0.0.0.0:5010
zeo-conf-additional =

[omelette]
recipe = collective.recipe.omelette
eggs = ${instance01:eggs}

[rabbitmq]
# required erlang-dev erlang-base erlang-ssl erlang-os-mon erlang-mnesia
recipe = rod.recipe.rabbitmq
url = http://www.rabbitmq.com/releases/rabbitmq-server/v1.7.2/rabbitmq-server-1.7.2.tar.gz
erlang-path = /usr/bin

[test]
recipe = zc.recipe.testrunner
eggs = affinitic.zamqp [test]
defaults = ['--tests-pattern', '^f?tests$']
script = test

[PILwoTK]
recipe = zc.recipe.egg
find-links =
    http://download.zope.org/distribution/

[instance01]
recipe = plone.recipe.zope2instance
user = admin:admin
verbose-security = on
http-address = 6080
zeo-client = True
zeo-address = ${zeo:zeo-address}
zeo-client-cache-size = 100MB
debug-mode = on
shared-blob = on
zcml = ${buildout:zcml}
zserver-threads = 4
eggs =
    PILwoTK
    Plone
    ${buildout:eggs}
zope-conf-additional =

[instance02]
recipe = ${instance01:recipe}
debug-mode = ${instance01:debug-mode}
verbose-security = ${instance01:verbose-security}
zeo-client = ${instance01:zeo-client}
zeo-address = ${instance01:zeo-address}
user = ${instance01:user}
http-address = 0.0.0.0:5012
shared-blob = on
zserver-threads = ${instance01:zserver-threads}
eggs = ${instance01:eggs}
zcml = ${instance01:zcml}
zope-conf-additional = ${instance01:zope-conf-additional}
zeo-client-cache-size = ${instance01:zeo-client-cache-size}
zope-conf-additional =

[docs]
recipe = z3c.recipe.sphinxdoc
eggs = affinitic.zamqp [docs]
build-dir = ${buildout:directory}/docs
default.css = ${buildout:directory}/docs/affinitic.css
layout.html = ${buildout:directory}/docs/layout.html
extensions = sphinx.ext.autodoc
             collective.sphinx.includedoc
             collective.sphinx.includechangelog
             repoze.sphinx.autointerface

[coverage-test]
recipe = zc.recipe.testrunner
eggs = affinitic.zamqp [test]
defaults = ['--coverage', '${buildout:directory}/coverage', '--auto-progress']

[coverage-report]
recipe = zc.recipe.egg
eggs = z3c.coverage
scripts = coverage
arguments = ('coverage', 'coverage/report')

[scripts]
recipe = zc.recipe.egg:scripts
eggs = affinitic.zamqp [zope212]

[command]
recipe = collective.recipe.cmd
on_install = true
on_update = true
cmds =
    ${buildout:directory}/bin/docs
    ${buildout:directory}/bin/coverage-test
    ${buildout:directory}/bin/coverage
